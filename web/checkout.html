<!DOCTYPE html>
<html lang="zxx" dir="ltr">
	
<head>
    <meta name="author" content="Kenora"> 
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>checkout</title>
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.ico" />
  
    <link rel="stylesheet" href="assets/css/plugins.min.css">
    <link rel="stylesheet" href="assets/css/style.min.css">
</head>

<body>
    <div class="main-wrapper">
        <!--		All pages top area start-->
        <header>	
            <!-- Header top area start phone/email/account-->
            <div class="header-top">
                <div class="container">
                    <div class="row justify-content-between align-items-center">
                        <div class="col d-none d-lg-block">
                            <div class="top-nav">
                                <ul>
                                    <li><a><i class="fa fa-phone"></i> +012 3456 789</a></li>
                                    <li><a><i class="fa fa-envelope-o"></i> NeBula@bjtuluc.com</a></li>
                                    <li><a href="login.html"><i class="fa fa-user"></i> Logout</a></li>
                                </ul>
                            </div>
							
                        </div>
                    </div>
                </div>
            </div>
            <!-- Header top area end -->
			
            <!-- Header action area start logo/search/wishlist/cart-->
            <div class="header-bottom  d-none d-lg-block">
                <div class="container">
                    <div class="row justify-content-between align-items-center">
                       <!--							logo-->
						<div class="col-lg-3 col">
                            <div class="header-logo">
                                <a href="index.html"><img src="assets/images/logo/logo.png" alt="Site Logo" /></a>
                            </div>
                        </div>
						<!--                        search-->
                        <div class="col-lg-6 d-none d-lg-block">
                            <div class="search-element">
								<form action="#">
                                    <input type="text" placeholder="Search" />
                                    <button><i class="pe-7s-search"></i></button>
                                </form>
                            </div>
                        </div>
                        <!--						icon-->
                        <div class="col-lg-3 col">
                            <div class="header-actions">
                               
							    
								<!-- Cart Start -->
                                <a href="cart.html" class="header-action-btn header-action-btn-cart">
                                    <i class="pe-7s-shopbag"></i>
<!--                                    <span class="header-action-num">01</span>-->
                                </a>
								<!-- Cart End -->							
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Header action area end -->
			           
			<!-- header navigation area start home/about/pages/shop/contact-->
                        <div class="header-nav-area d-none d-lg-block sticky-nav">
                <div class="container">
                    <div class="header-nav">
                        <div class="main-menu position-relative">
                            <ul>
								<li><a href=" index.html">Home</a></li>
                                <li><a href=" about.html">About</a></li>
								<li><a href=" shop-3-column.html">shop</a></li>
								<li class="dropdown position-static"><a href=" about.html">My<i class="fa fa-angle-down"></i></a>
                                    <ul class="mega-menu d-block">
                                        <li class="d-flex">
                                            <ul class="d-block">
                                                <li><a href=" cart.html">Cart Page</a></li>
                                            </ul>
                                            <ul class="d-block">
                                               <li><a href=" order-tracking.html">Order Tracking</a></li>
                                            </ul>  
                                            <ul class="d-flex align-items-center p-0 border-0 flex-column justify-content-center">
                                            </ul>
                                        </li>
                                    </ul>
                                </li>								
                                <li><a href=" contact.html">Contact</a></li>

								
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- header navigation area end -->
        </header>
        <!--		All pages top area end-->
        <!-- path start -->
        <div class="breadcrumb-area">
            <div class="container">
                <div class="row align-items-center justify-content-center">
                    <div class="col-12 text-center">
                        <h2 class="breadcrumb-title">Checkout</h2>
                        <!-- breadcrumb-list start -->
                        <ul class="breadcrumb-list">
                            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            <li class="breadcrumb-item active">Checkout</li>
                        </ul>
                        <!-- breadcrumb-list end -->
                    </div>
                </div>
            </div>
        </div>
        <!-- path end -->
		
        <!-- checkout area start -->
        <div class="checkout-area pt-100px pb-100px">
            <div class="container">
                <div class="row">
                    <div class="col-lg-7">
                        <div class="billing-info-wrap">
                            <h3>Billing Details</h3>
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <div class="billing-info mb-4">
                                        <label>Name</label>
                                        <input type="text" />
                                    </div>
                                </div>
                               
                                <div class="col-lg-12">
                                    <div class="billing-info mb-4">
                                        <label>Address</label>
                                        <input class="billing-address" type="text" />
<!--                                        <input placeholder="Apartment, suite, unit etc." type="text" />-->
                                    </div>
                                </div>
                                
                                
                                <div class="col-lg-6 col-md-6">
                                    <div class="billing-info mb-4">
                                        <label>Phone</label>
                                        <input type="text" />
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="billing-info mb-4">
                                        <label>Email Address</label>
                                        <input type="text" />
                                    </div>
                                </div>
                            </div>
                           
                            <div class="checkout-account-toggle open-toggle2 mb-30">
                                <input placeholder="Email address" type="email" />
                                <input placeholder="Password" type="password" />
                                <button class="btn-hover checkout-btn" type="submit">register</button>
                            </div>
                            <div class="additional-info-wrap">
                                <h4>Additional information</h4>
                                <div class="additional-info">
                                    <label>Order notes</label>
                                    <textarea placeholder="Notes about your order, e.g. special notes for delivery. " name="message"></textarea>
                                </div>
                            </div>
                            
                            <div class="different-address open-toggle mt-30px">
                                <div class="row">
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-4">
                                            <label>First Name</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-4">
                                            <label>Last Name</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-info mb-4">
                                            <label>Company Name</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-select mb-4">
                                            <label>Country</label>
                                            <select>
                                                <option>Select a country</option>
                                                <option>Azerbaijan</option>
                                                <option>Bahamas</option>
                                                <option>Bahrain</option>
                                                <option>Bangladesh</option>
                                                <option>Barbados</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-info mb-4">
                                            <label>Street Address</label>
                                            <input class="billing-address" placeholder="House number and street name" type="text" />
                                            <input placeholder="Apartment, suite, unit etc." type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-info mb-4">
                                            <label>Town / City</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-4">
                                            <label>State / County</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-4">
                                            <label>Postcode / ZIP</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-4">
                                            <label>Phone</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-4">
                                            <label>Email Address</label>
                                            <input type="text" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5 mt-md-30px mt-lm-30px ">
                        <div class="your-order-area">
                            <h3>Your order</h3>
                            <div class="your-order-wrap gray-bg-4">
                                <div class="your-order-product-info">
                                    <div class="your-order-top">
                                        <ul>
                                            <li>Product</li>
                                            <li>Total</li>
                                        </ul>
                                    </div>
                                    <div class="your-order-middle">
                                        <ul id="checkoutProduct">
<!--                                            <li><span id="nameAmount" class="order-middle-left">Product Name X amount</span>
                                                <span id="priceN" class="order-price">$ price </span></li>-->
<!--                                            <li><span class="order-middle-left">Product Name X 1</span> 
                                                <span class="order-price">$100 </span></li>-->
                                        </ul>
                                    </div>
                                    <div class="your-order-bottom">
                                        <ul>
                                            <li class="your-order-shipping">Shipping</li>
                                            <li>Free shipping</li>
                                        </ul>
                                    </div>
                                    <!--total-->
<!--                                    <div class="your-order-total">
                                        <ul>
                                            <li class="order-total">Total</li>
                                            <li>$100</li>
                                        </ul>
                                    </div>-->
                                </div>
                                <div class="payment-method">
                                    <div class="payment-accordion element-mrg">
                                        <div id="faq" class="panel-group">
                                            <div class="panel panel-default single-my-account m-0">
                                                <div class="panel-heading my-account-title">
                                                    <h4 class="panel-title"><a data-bs-toggle="collapse" href="#my-account-1" class="collapsed" aria-expanded="true">Direct bank transfer</a>
                                                    </h4>
                                                </div>
                                                <div id="my-account-1" class="panel-collapse collapse show" data-bs-parent="#faq">
                                                    <div class="panel-body">
                                                        <p>Please send a check to Store Name, Store Street, Store Town,
                                                            Store State / County, Store Postcode.</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel panel-default single-my-account m-0">
                                                <div class="panel-heading my-account-title">
                                                    <h4 class="panel-title"><a data-bs-toggle="collapse" href="#my-account-2" aria-expanded="false" class="collapsed">Check payments</a></h4>
                                                </div>
                                                <div id="my-account-2" class="panel-collapse collapse" data-bs-parent="#faq">
                                                    <div class="panel-body">
                                                        <p>Please send a check to Store Name, Store Street, Store Town,
                                                            Store State / County, Store Postcode.</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel panel-default single-my-account m-0">
                                                <div class="panel-heading my-account-title">
                                                    <h4 class="panel-title"><a data-bs-toggle="collapse" href="#my-account-3">Cash on delivery</a></h4>
                                                </div>
                                                <div id="my-account-3" class="panel-collapse collapse" data-bs-parent="#faq">
                                                    <div class="panel-body">
                                                        <p>Please send a check to Store Name, Store Street, Store Town,
                                                            Store State / County, Store Postcode.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="Place-order mt-25">
                                <a id="payNow" class="btn-hover" href="thank-you-page.html">pay now</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- checkout area end -->

    </div>
 

    <script src=" assets/js/jQuery.mini.js"></script>
    <script src=" assets/js/vendor.min.js"></script>
    <script src=" assets/js/plugins.min.js"></script>
    <script src=" assets/js/main.min.js"></script>
    <script>
    $(function(){ 
//            $("#login").click(function(){

                function Order(productID,productAmount,productPrice) {
                    this.productID = productID;
                    this.productAmount = productAmount;
                    this.productPrice = productPrice;
                };
                
                

                $.ajax({
                      type: 'GET',
                      url: "http://localhost:8080/NeBula/cart",
                      dataType: "json",
//                      dataType: "text",
                      async: false,
//                      crossDomain: true,

                      success:function(response){
                        //cart
                        var cart = response;
                        //提交给order的objs
                        var checkout = new Array();
                        var cartProductID = new Array();
                        var amount = new Array();
                        
                        var name = new Array();
                        var price = new Array();
                        var productID = new Array();
                        
                        //Try
                        var data = {
                            productList:[]
                        };

                        

//                        console.log("success ajax1");
//                        console.log("response",response);
//                        console.log("cart",cart);
//                        console.log("typeof(response):",typeof(response));
//                        
                        //提取cart里面的product对象
                        for(var i=0; i<cart.length; i++){
                            console.log(cart[i]);
                            //动态生成订单项
                            $(".your-order-middle>ul").append("<li>");
//                          //name&amount
                            $(".your-order-middle>ul").append("<span id=\"nameAmount"+i+"\""+" class=\"order-middle-left\">Product Name X amount</span>");
                            console.log("<span id=\"nameAmount"+i+"\""+" class=\"order-middle-left\">Product Name X amount</span>");
                            //price
                            $(".your-order-middle>ul").append("<span id=\"price"+i+"\""+" class=\"order-price\">$ price </span>");
                            console.log("<span id=\"price"+i+"\""+" class=\"order-price\">$ price </span>");
                            $(".your-order-middle>ul").append("</li>");
                            
//                            $(".your-order-middle>ul").listview("refresh"); 
                        }
                        
                        //提取product的amount/ID
                        for(var i=0; i<cart.length; i++){
                            //cart product ID
//                            console.log("cart[i].productID",cart[i].productID);
                            cartProductID[i] = cart[i].productID;
//                            console.log("cartProductID[i]:",cartProductID[i]);  
                            //cart product amount
//                            console.log("cart[i].amount",cart[i].amount);
                            amount[i] = cart[i].amount;
//                            console.log("amount[i]:",amount[i]); 
//                            //amount加载到每个product中                       
//                            $("#"+"amount"+i).text(amount[i]);
//                            console.log("#"+"amount"+i);
                        }
                        
                        //获取cart内product的name price（根据productID判断）
                        $.ajax({
                                type: 'GET',
                                url: "http://localhost:8080/NeBula/product",
                                dataType: "json",
                                async: false,
                                success:function(response){
                                  var product = response;
//                                  var name = new Array();
//                                  var price = new Array();
//                                  var productID = new Array();
//                                  
          //                        test ajax
                                  console.log("success ajax2");
                                  console.log(response);
//                                  console.log("typeof(response):",typeof(response));
          //                        console.log("response content:",JSON.stringify(response)); //把json转换为string
//                                  console.log("data.length:",product.length);

                                  //获取所有的里面product
                                  for(var i=0; i<product.length; i++){
                                      console.log(""+product[i]);
                                  }
                                  
                                  //获取product的id
                                  for(var i=0; i<product.length; i++){
//                                      console.log("product[i].id",product[i].id);
                                      productID[i] = product[i].id;
//                                      console.log("productID[i]:",productID[i]);
                                  }
                                  
                                   console.log("获取里面product的属性值:");
                                  //获取里面allproduct的属性值
                                  for(var i=0; i<product.length; i++){
                                      //id
//                                      console.log("product[i].id",product[i].id);
//                                      productID[i] = product[i].id;
//                                      console.log("productID[i]:",productID[i]);
                                      //判断product是否在cart内（判断cartProductID和allProductID是否相同）
                                      for(var j=0; j<cartProductID.length; j++){
//                                         console.log("进来了"); 
                                        if(cartProductID[j] == productID[i]){
                                        //把cart里面要结账的商品obj放入checkout里
//                                        checkout.push(cart[i]);
//                                        data.productList.push(cart[i]);
                                        console.log("checkout objs:",checkout);
                                        //name
//                                        console.log("product[i].name:",product[i].name);
                                        name[i] = product[i].name;
                                        console.log("name[i]:",name[i]);  
                                        //放入productName
                                        $("#"+"nameAmount"+i).text(name[i]+" X "+amount[i]);
                                        console.log("#"+"nameAmount"+i);
                                        console.log(name[i]+" X "+amount[i]);
                                        //price
//                                        console.log("product[i].price:",product[i].price);
                                        price[i] = product[i].price;
                                        console.log("price[i]:",price[i]);
                                        //放入productPrice
                                        $("#"+"price"+i).text("$ "+price[i]);
                                      };
                                      }//for
                                  }//for
                                  
                                  for(var i=0; i<cart.length; i++){
                                        var order= new Order(productID[i],amount[i],price[i]);
                                        data.productList.push(order);
                                    }
                                  
                                  //Try
//                                  data.productList.push(checkout);
//                                  console.log("data.productList:",data.productList);
//                                  data.push(productList);
//                                  data = {"productList",productList};
//                                  console.log("data:",data);
                                  
                                  
                                  $("#payNow").click(function(){
//                                      var data = {
//                                          productList: [
//                                              {"productID":"12997278088298496","productAmount":"2","productPrice":"8999"},
//                                              {"productID":"12997710701395968","productAmount":"2","productPrice":"7999"}
//                                          ]
//                                      };

//                                      console.log(data);
//                                      console.log(data)
                                      $.ajax({
                                            type: 'POST',
                                            url: "http://localhost:8080/NeBula/order/",
                                            dataType: "json",
                                            contentType:"application/json",
                                            data: JSON.stringify(data),
                                            async: false,
                                            success:function(response){
                                                console.log("post sucessfully",response);
                                            },
                                            error:function(response){
                                                console.log(JSON.stringify(data));
                                                console.log("post fail",response);  

                                            }
 
                                      });//end of ajax3
                                  });//end of paynow post
                                  
                                  console.log("end of success ajax2");     
                                },//success

                               error:function(response){
//                                  alert("fail ajax");
                                  console.log("fail ajax",response);
                                  console.log("end of fail ajax");     
                                }//error
                        });// end of ajax2 (加载信息到product)
                      
                        console.log("end of success ajax1");     
                      },//ajax1 success
                      
                     error:function(response){
//                        alert("fail ajax");
                        console.log("fail ajax",response);
                        console.log("end of fail ajax");     
                      }//ajax1 error
                      
                    });//end of ajax1
                 return false; //加上才能实现页面跳转 window.location.href
        });//start
    </script>
</body>

</html>